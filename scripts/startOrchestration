#!/bin/bash

# one time tasks
CWD="`pwd`";
echo "waiting for monitoring service to begin."
USER=$(whoami)
# while [ ! -f $CWD'/usage.txt' ]
# do
#   sleep 2
# done
cd ..
javac proxy/*.java
java proxy/Proxy &

javac URLShortner.java
for host in `cat ./proxy/hosts.txt`
do
	ssh $host "cd \"$CWD\"; ./startNode"
done

# setup recurring tasks
crontab -u ${USER} -l > $CWD/crontab
           /bin/echo "* * * * * /bin/bash -c 'cd /student/${USER}/csc409/repo_a1group10/scripts && ./healthService' > cron.error
* * * * * ( sleep 30 ; /bin/bash -c 'cd /student/${USER}/csc409/repo_a1group10/scripts && ./healthService' > cron.error )" >> $CWD/crontab
crontab $CWD/crontab
rm -rf $CWD/crontab
